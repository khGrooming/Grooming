<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="groomingMapper">
 
 	<resultMap type="Grooming" id="groomingResultSet">
		<id property="groomingNo" column="GROOMING_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="groomingType" column="GROOMING_TYPE"/>
		<result property="groomingTitle" column="GROOMING_TITLE"/>
		<result property="groomingContent" column="GROOMING_CONTENT"/>
		<result property="groomingIntroduce" column="GROOMING_INTRODUCE"/>
		<result property="groomingP" column="GROOMING_PARTICIPANTS"/>
		<result property="studySd" column="STUDY_START_DATE"/>
		<result property="studyEd" column="STUDY_END_DATE"/>
		<result property="groomingSd" column="GROOMING_START_DATE"/>
		<result property="groomingEd" column="GROOMING_END_DATE"/>
		<result property="money" column="DEPOSIT_MONEY"/>
		<result property="groomingImg" column="GROOMING_IMG"/>
		<result property="groomingCd" column="GROOMING_CREATE_DATE"/>
		<result property="groomingMd" column="GROOMING_MODIFY_DATE"/>
		<result property="status" column="GROOMING_STATUS"/>
		<result property="count" column="GROOMING_COUNT"/>
		<result property="groomingNd" column="GROOMING_NOW_DATE"/>
		<result property="currentP" column="GROOMING_CURRENT_PEOPLE"/>
		
	</resultMap>
	
 
	
 	<resultMap type="Gspec" id="gSpecResultSet">
		<id property="specNo" column="SPEC_NO"/>
		<result property="specCNo" column="SPEC_C_NO"/>
		<result property="specName" column="SPEC_NAME"/>
		<result property="specFileName" column="SPEC_FILENAME"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="specConfirm" column="SPEC_CONFIRM"/>
		
		
	</resultMap>
	 
	 <resultMap type="Gapp" id="gAppResultSet">
		<id property="groomingAN" column="GROOMING_APPLY_NO"/>
		<result property="memberNickName" column="MEMBER_NICKNAME"/>
		<result property="memberPhoto" column="MEMBER_PHOTO"/>
		<result property="groomingAC" column="GROOMING_APPLY_CONTENT"/>
		
		
	</resultMap>
	
	 <resultMap type="GroomingAp" id="GACResultSet">
		<id property="groomingAn" column="GROOMING_APPLY_NO"/>
		<result property="groomingNo" column="GROOMING_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="groomingAC" column="GROOMING_APPLY_CONTENT"/>
		<result property="groomingAS" column="GROOMING_APPLY_STATUS"/>
		
		
	</resultMap>
 
	 <resultMap type="Gheart" id="GheartResultSet">
		<id property="groomingHNo" column="GROOMING_HEART_NO"/>
		<result property="groomingNo" column="GROOMING_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
	</resultMap>
	 <resultMap type="Gmember" id="GmemberResultSet">
		<id property="gmemberNo" column="G_MEMBER_NO"/>
		<result property="groomingNo" column="GROOMING_NO"/>
		<result property="memberNo" column="MEMBER_NO"/>
	</resultMap>
	
 	<select id="selectList" resultMap="groomingResultSet">
 		SELECT * 
 		FROM GROOMING
 		WHERE GROOMING_STATUS ='Y'
 			OR GROOMING_STATUS = 'B'
 		
 	</select>
 	
 	<select id="selectMentorList" resultMap="groomingResultSet">
 		SELECT * 
 		FROM GROOMING 
 		WHERE GROOMING_TYPE ='멘토'
 		ORDER BY GROOMING_NO DESC
 		
 	</select>
 
 	<select id="gSearchTitle" parameterType="string" resultMap="groomingResultSet" >
 		SELECT *
		FROM GROOMING G
		JOIN MEMBER M ON (M.MEMBER_NO = G.MEMBER_NO)
		WHERE GROOMING_STATUS ='Y'
		AND GROOMING_TITLE LIKE '%' || #{title} || '%'
		ORDER BY GROOMING_NO DESC	
		
			
 	
 	</select>
 	<select id="gSearchWriter" parameterType="string" resultMap="groomingResultSet" >
 		SELECT *
		FROM GROOMING G
		JOIN MEMBER M ON (M.MEMBER_NO = G.MEMBER_NO)
		WHERE GROOMING_STATUS ='Y'
		AND MEMBER_NICKNAME LIKE '%' || #{writer} || '%'
		ORDER BY GROOMING_NO DESC	
		
			
 	
 	</select>
 	<select id="gSearchContent" parameterType="string" resultMap="groomingResultSet" >
 		SELECT *
		FROM GROOMING G
		JOIN MEMBER M ON (M.MEMBER_NO = G.MEMBER_NO)
		WHERE GROOMING_STATUS ='Y'
		AND GROOMING_CONTENT LIKE '%' || #{content} || '%'
		ORDER BY GROOMING_NO DESC	
	
 	</select>
 
 	<update id="updateCount" parameterType="string">
 		UPDATE GROOMING
 		SET GROOMING_COUNT = GROOMING_COUNT +1
 		WHERE GROOMING_NO = #{groomingNo}
 	
 	</update>
 
 	<select id="selectOne" parameterType="string" resultMap="groomingResultSet">
		SELECT *
		FROM GROOMING G
		WHERE GROOMING_NO=#{groomingNo}
		
		
	</select>
 
 	<select id="selectMoneyList" resultMap="groomingResultSet">
 		SELECT * 
 		FROM GROOMING 
 		WHERE DEPOSIT_MONEY > 0
 		ORDER BY GROOMING_NO DESC
 	
 	</select>
 
 
 	
 	<select id="selectSpec" parameterType="string" resultMap="gSpecResultSet">
 		SELECT SPEC_NAME
        FROM SPEC S
        JOIN GROOMING G ON G.MEMBER_NO = S.MEMBER_NO
        WHERE GROOMING_NO = #{groomingNo}
 	
 	</select>
 	
 	<insert id="insertGrooming" parameterType="Grooming" >
 		INSERT INTO GROOMING VALUES(
 			'G' || LPAD(SEQ_GROOMING_NO.NEXTVAL,5,0)
 			, #{memberNo}
 			, #{groomingType}
 			, #{groomingTitle}
 			, #{groomingContent}
 			, #{groomingIntroduce}
 			, #{groomingP}
 			, #{studySd}
 			, #{studyEd}
 			, #{groomingSd}
 			, #{groomingEd} 
 		
 			<if test="money != ''">
 			,#{money}
 			</if>
 			<if test="money == '' ">
 			 ,DEFAULT
 			</if>
 		
 			, #{groomingImg}
 			, DEFAULT
 			, DEFAULT
 			, 'Y'
 			, DEFAULT
 			, SYSDATE
 			, DEFAULT
 			)
	
	
 	</insert>
 	
  	<select id="selectAppContent" parameterType="string" resultMap="gAppResultSet">
 	SELECT GROOMING_APPLY_NO,M.MEMBER_NICKNAME,M.MEMBER_PHOTO,GROOMING_APPLY_CONTENT
	FROM GROOMING_APPLICANT GA
	JOIN MEMBER M ON GA.MEMBER_NO = M.MEMBER_NO
	WHERE GROOMING_APPLY_STATUS = 'Y' 
	AND GROOMING_NO= #{groomingNo}
	
 	
 	</select> 
 	
 	<update id="selectApplyOne" parameterType="string">
 	UPDATE GROOMING_APPLICANT
	SET GROOMING_APPLY_STATUS = 'C'
	WHERE GROOMING_APPLY_NO =#{applyNo}
 	</update>

 	<update id="rejectApp" parameterType="string">
 	UPDATE GROOMING_APPLICANT
	SET GROOMING_APPLY_STATUS = 'D'
	WHERE GROOMING_APPLY_NO =#{applyNo}
 	</update>
 	
 	<update id="addGroomingP" parameterType="string">
 	UPDATE GROOMING
	SET GROOMING_CURRENT_PEOPLE = GROOMING_CURRENT_PEOPLE + 1
	WHERE GROOMING_NO =#{groomingNo}
 	</update>
 	
 	<update id="updateGrooming" parameterType="Grooming">
 		UPDATE GROOMING
 		SET GROOMING_TYPE = #{groomingType},
 		GROOMING_TITLE = #{groomingTitle},
 		GROOMING_CONTENT = #{groomingContent},
 		GROOMING_INTRODUCE = #{groomingIntroduce},
 		GROOMING_PARTICIPANTS = #{groomingP},
 		STUDY_START_DATE = #{studySd},
 		STUDY_END_DATE = #{studyEd},
 		GROOMING_START_DATE = #{groomingSd},
 		GROOMING_END_DATE = #{groomingEd},
 		DEPOSIT_MONEY = #{money},
 		GROOMING_IMG = #{groomingImg},
 		GROOMING_MODIFY_DATE = SYSDATE 		
 		WHERE GROOMING_NO =#{groomingNo}
 	
 	</update>
 	
 	<delete id="groomingDelete" parameterType="string">
 		DELETE FROM GROOMING
 		WHERE GROOMING_NO = #{groomingNo}
 	</delete>
 	
 	<update id="statusUpdate" >
 	<![CDATA[ 
 		UPDATE GROOMING
 		SET GROOMING_STATUS = 'B'
 		WHERE GROOMING_NO = #{groomingNo}
 	]]>
 	</update>
 	
 	<insert id="applyContent" parameterType="GroomingAp">
 		INSERT INTO GROOMING_APPLICANT VALUES(
 		'GA' || LPAD(SEQ_GROOMING_APPLY_NO.NEXTVAL,5,0)
 		,#{groomingNo}
 		,#{memberNo}
 		,#{groomingAC}
 		,DEFAULT
 		)
 		
 	</insert>
 	
 	<select id="selectAppMemberNo" parameterType="map" resultMap="GACResultSet">
 		SELECT *
 		FROM GROOMING_APPLICANT
 		WHERE GROOMING_NO = #{groomingNo}
 		AND MEMBER_NO = #{memberNo}
 	
 	
 	</select>
 	
 	<select id="selectHeartMember" parameterType="map" resultMap="GheartResultSet">
 		SELECT *
 		FROM GROOMING_HEART
 		WHERE GROOMING_NO = #{groomingNo}
 		AND MEMBER_NO = #{memberNo}
 	
 	
 	</select>
 	
 	<insert id="addHeart" parameterType="map">
 		INSERT INTO GROOMING_HEART VALUES(
 		'GH' || LPAD(SEQ_GROOMING_APPLY_NO.NEXTVAL,5,0)
 		,#{groomingNo}
 		,#{memberNo}
 		)
 	
 	</insert>
 	
 	
 	<delete id="cancelHeart" parameterType="map">
		DELETE
		FROM GROOMING_HEART
		WHERE GROOMING_NO = #{groomingNo}
		AND MEMBER_NO = #{memberNo}

 	</delete>
 	
 	<select id="selectGimg" parameterType="string" resultType="string">
 		SELECT GROOMING_IMG
 		FROM GROOMING
 		WHERE GROOMING_NO = #{groomingNo}
 	
 	
 	
 	</select>
 	<select id="findAppMemberNo" parameterType="string" resultType="string">
 		SELECT MEMBER_NO
 		FROM GROOMING_APPLICANT
 		WHERE GROOMING_APPLY_NO = #{applyNo}
 	
 	</select>
 	<insert id="addGroomingMember" parameterType="map">
 		INSERT INTO GROMMING_MEMBER VALUES(
 		'GM' || LPAD(SEQ_GROOMING_APPLY_NO.NEXTVAL,5,0)
 		,#{memberNo}
 		,#{groomingNo}
 	)
 	</insert>
 	
 	
 	
</mapper>
